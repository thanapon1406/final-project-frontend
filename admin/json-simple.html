<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>แก้ไข JSON - ห้วยตึงเฒ่า</title>
    <!-- Bootstrap 5.3.0 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Thai Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Itim:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Itim", cursive;
        background-color: #f8f9fa;
      }
      .json-card {
        transition: all 0.2s;
        cursor: pointer;
      }
      .json-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }
      .btn-save {
        background: #28a745;
        border: none;
        color: white;
      }
      .btn-save:hover {
        background: #218838;
        color: white;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark bg-primary">
      <div class="container">
        <span class="navbar-brand"
          ><i class="fas fa-code me-2"></i>แก้ไข JSON - ห้วยตึงเฒ่า</span
        >
        <a class="btn btn-outline-light btn-sm" href="../index.html">
          <i class="fas fa-home me-1"></i>กลับหน้าหลัก
        </a>
      </div>
    </nav>

    <div class="container mt-4">
      <!-- Alert -->
      <div id="alert"></div>

      <!-- File Selection -->
      <div id="fileList">
        <h3 class="mb-4">เลือกไฟล์ JSON ที่ต้องการแก้ไข</h3>
        <div class="row g-3">
          <div class="col-md-3">
            <div
              class="card json-card h-100"
              onclick="editFile('homepage-carousel')"
            >
              <div class="card-body text-center">
                <i class="fas fa-images fa-2x text-primary mb-2"></i>
                <h6>สไลด์หน้าหลัก</h6>
                <small class="text-muted">homepage-carousel.json</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div
              class="card json-card h-100"
              onclick="editFile('homepage-news')"
            >
              <div class="card-body text-center">
                <i class="fas fa-newspaper fa-2x text-success mb-2"></i>
                <h6>ข่าวสาร</h6>
                <small class="text-muted">homepage-news.json</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div
              class="card json-card h-100"
              onclick="editFile('page-services')"
            >
              <div class="card-body text-center">
                <i class="fas fa-tools fa-2x text-warning mb-2"></i>
                <h6>หน้าบริการ</h6>
                <small class="text-muted">page-services.json</small>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div
              class="card json-card h-100"
              onclick="editFile('contact-content')"
            >
              <div class="card-body text-center">
                <i class="fas fa-phone fa-2x text-info mb-2"></i>
                <h6>หน้าติดต่อ</h6>
                <small class="text-muted">contact-content.json</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Editor -->
      <div id="editor" style="display: none">
        <div class="card">
          <div
            class="card-header d-flex justify-content-between align-items-center"
          >
            <h5 class="mb-0">แก้ไขไฟล์: <span id="fileName"></span></h5>
            <button
              class="btn btn-outline-secondary btn-sm"
              onclick="backToList()"
            >
              <i class="fas fa-arrow-left me-1"></i>กลับ
            </button>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <h6>แก้ไขข้อมูล JSON:</h6>
                <textarea
                  id="jsonEditor"
                  class="form-control"
                  rows="20"
                  style="font-family: monospace"
                ></textarea>
              </div>
              <div class="col-md-6">
                <h6>ตัวอย่างผลลัพธ์:</h6>
                <pre
                  id="jsonPreview"
                  style="
                    background: #f8f9fa;
                    padding: 15px;
                    border-radius: 5px;
                    height: 500px;
                    overflow-y: auto;
                    font-size: 12px;
                  "
                ></pre>
              </div>
            </div>

            <div class="text-center mt-3">
              <button class="btn btn-save btn-lg me-2" onclick="saveJson()">
                <i class="fas fa-download me-2"></i>ดาวน์โหลดไฟล์
              </button>
              <button
                class="btn btn-outline-warning btn-lg me-2"
                onclick="resetJson()"
              >
                <i class="fas fa-undo me-2"></i>รีเซ็ต
              </button>
              <button
                class="btn btn-outline-info btn-lg"
                onclick="formatJson()"
              >
                <i class="fas fa-magic me-2"></i>จัดรูปแบบ
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      let currentFile = "";
      let originalData = "";

      // Edit file
      async function editFile(fileName) {
        try {
          showAlert("กำลังโหลดข้อมูล...", "info");

          // Try multiple paths
          const paths = [
            `../data/${fileName}.json`,
            `data/${fileName}.json`,
            `${fileName}.json`,
          ];

          let data = null;
          let success = false;

          for (const path of paths) {
            try {
              console.log(`Trying: ${path}`);
              const response = await fetch(path);
              if (response.ok) {
                const text = await response.text();
                data = JSON.parse(text);
                console.log(`Success from: ${path}`, data);
                success = true;
                break;
              }
            } catch (e) {
              console.log(`Failed: ${path}`, e);
              continue;
            }
          }

          if (!success) {
            // Use sample data
            data = getSampleData(fileName);
            showAlert("ไม่พบไฟล์ ใช้ข้อมูลตัวอย่าง", "warning");
          } else {
            showAlert("โหลดข้อมูลสำเร็จ", "success");
          }

          currentFile = fileName;
          originalData = JSON.stringify(data, null, 2);

          document.getElementById("fileName").textContent = `${fileName}.json`;
          document.getElementById("jsonEditor").value = originalData;
          document.getElementById("jsonPreview").textContent = originalData;

          document.getElementById("fileList").style.display = "none";
          document.getElementById("editor").style.display = "block";

          // Auto-update preview
          document
            .getElementById("jsonEditor")
            .addEventListener("input", updatePreview);
        } catch (error) {
          console.error("Error:", error);
          showAlert("เกิดข้อผิดพลาด: " + error.message, "danger");
        }
      }

      // Update preview
      function updatePreview() {
        try {
          const text = document.getElementById("jsonEditor").value;
          const parsed = JSON.parse(text);
          document.getElementById("jsonPreview").textContent = JSON.stringify(
            parsed,
            null,
            2
          );
          document.getElementById("jsonPreview").style.color = "black";
        } catch (e) {
          document.getElementById("jsonPreview").textContent =
            "JSON Error: " + e.message;
          document.getElementById("jsonPreview").style.color = "red";
        }
      }

      // Format JSON
      function formatJson() {
        try {
          const text = document.getElementById("jsonEditor").value;
          const parsed = JSON.parse(text);
          const formatted = JSON.stringify(parsed, null, 2);
          document.getElementById("jsonEditor").value = formatted;
          updatePreview();
          showAlert("จัดรูปแบบสำเร็จ", "success");
        } catch (e) {
          showAlert("JSON ไม่ถูกต้อง: " + e.message, "danger");
        }
      }

      // Reset JSON
      function resetJson() {
        if (confirm("ต้องการรีเซ็ตกลับเป็นข้อมูลเดิมหรือไม่?")) {
          document.getElementById("jsonEditor").value = originalData;
          updatePreview();
          showAlert("รีเซ็ตแล้ว", "info");
        }
      }

      // Save JSON
      function saveJson() {
        try {
          const text = document.getElementById("jsonEditor").value;
          const parsed = JSON.parse(text); // Validate JSON

          // Download file
          const blob = new Blob([text], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `${currentFile}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          showAlert(
            "ดาวน์โหลดไฟล์สำเร็จ! นำไฟล์ไปแทนที่ในโฟลเดอร์ data/",
            "success"
          );
        } catch (e) {
          showAlert("JSON ไม่ถูกต้อง: " + e.message, "danger");
        }
      }

      // Back to list
      function backToList() {
        document.getElementById("editor").style.display = "none";
        document.getElementById("fileList").style.display = "block";
        currentFile = "";
        originalData = "";
      }

      // Get sample data
      function getSampleData(fileName) {
        const samples = {
          "homepage-carousel": {
            slides: [
              {
                id: 1,
                title: "ยินดีต้อนรับสู่ห้วยตึงเฒ่า",
                description:
                  "สถานที่ท่องเที่ยวเชิงนิเวศที่สวยงามในจังหวัดเชียงใหม่",
                image: "https://example.com/image1.jpg",
                active: true,
                link: {
                  url: "#about",
                  target: "_self",
                },
              },
              {
                id: 2,
                title: "ธรรมชาติบริสุทธิ์",
                description:
                  "สัมผัสอากาศบริสุทธิ์และความเงียบสงบท่ามกลางธรรมชาติ",
                image: "https://example.com/image2.jpg",
                active: true,
                link: {
                  url: "#gallery",
                  target: "_self",
                },
              },
            ],
            controls: {
              interval: 5000,
              prevButton: true,
              nextButton: true,
              indicators: true,
            },
          },
          "homepage-news": {
            announcements: [
              {
                id: 1,
                text: "ห้วยตึงเฒ่าของเรา เปิดให้บริการทุกวันไม่มีวันหยุดตั้งแต่เวลา 06:30 - 18:00 น.",
                priority: "high",
                active: true,
              },
            ],
            newsTable: [
              {
                date: "1 มกราคม 2567",
                content: "ข่าวสารตัวอย่าง",
              },
            ],
          },
          "page-services": {
            services: {
              title: "บริการต่างๆ",
              subtitle: "เรามีบริการต่างๆมากมาย",
              mainServices: [
                {
                  id: 1,
                  title: "บริการตัวอย่าง",
                  description: "คำอธิบายบริการ",
                  image: "https://example.com/service.jpg",
                },
              ],
            },
          },
          "contact-content": {
            contact: {
              title: "ติดต่อเรา",
              organization: "ห้วยตึงเฒ่า",
              phone: "053-298-034",
              email: "info@example.com",
            },
          },
        };

        return samples[fileName] || { message: "ไม่พบข้อมูลตัวอย่าง" };
      }

      // Show alert
      function showAlert(message, type = "info") {
        const alertDiv = document.getElementById("alert");
        alertDiv.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;

        if (type === "success" || type === "info") {
          setTimeout(() => {
            const alert = alertDiv.querySelector(".alert");
            if (alert) {
              const bsAlert = new bootstrap.Alert(alert);
              bsAlert.close();
            }
          }, 3000);
        }
      }
    </script>
  </body>
</html>
