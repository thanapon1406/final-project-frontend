<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSON Editor - ห้วยตึงเฒ่า Admin</title>
    <!-- Bootstrap 5.1.3 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome 5.10.0 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
    />
    <!-- Thai Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/admin.css" />
    <style>
      :root {
        --primary-color: #2c3e50;
        --secondary-color: #34495e;
        --accent-color: #3498db;
        --success-color: #27ae60;
        --warning-color: #f39c12;
        --text-primary: #2c3e50;
        --text-light: #ffffff;
        --bg-primary: #ffffff;
        --bg-secondary: #f8f9fa;
        --bg-light: #ecf0f1;
        --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
        --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      body {
        background-color: var(--bg-secondary);
      }

      .json-file-card {
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
        box-shadow: var(--shadow-sm);
      }

      .json-file-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
      }

      .json-file-card .card-body {
        padding: 1.5rem;
      }

      .json-file-card .fa-3x {
        margin-bottom: 1rem;
      }

      .json-file-card .text-primary {
        color: var(--primary-color) !important;
      }
      .json-file-card .text-success {
        color: var(--success-color) !important;
      }
      .json-file-card .text-warning {
        color: var(--warning-color) !important;
      }
      .json-file-card .text-info {
        color: var(--accent-color) !important;
      }
      .json-file-card .text-secondary {
        color: var(--secondary-color) !important;
      }

      .form-control,
      .form-select {
        font-family: "Noto Sans Thai", sans-serif;
        border-color: #dee2e6;
        transition: border-color 0.3s ease;
      }

      .form-control:focus,
      .form-select:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
      }

      .btn-save {
        background: linear-gradient(
          45deg,
          var(--success-color),
          var(--accent-color)
        );
        border: none;
        color: var(--text-light);
        transition: all 0.3s ease;
      }

      .btn-save:hover {
        background: linear-gradient(45deg, #229954, #2980b9);
        color: var(--text-light);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .admin-sidebar {
        background: var(--primary-color) !important;
        min-height: 100vh;
      }

      .admin-sidebar .nav-link {
        color: rgba(255, 255, 255, 0.8) !important;
        transition: all 0.3s ease;
        border-radius: 5px;
        margin: 0.2rem 0;
      }

      .admin-sidebar .nav-link:hover {
        color: var(--text-light) !important;
        background-color: rgba(255, 255, 255, 0.1);
      }

      .admin-sidebar .nav-link.active {
        color: var(--text-light) !important;
        background-color: var(--accent-color);
      }

      .admin-sidebar .text-danger {
        color: #e74c3c !important;
      }

      .admin-sidebar .text-danger:hover {
        color: #c0392b !important;
        background-color: rgba(231, 76, 60, 0.1);
      }

      .admin-content {
        background-color: var(--bg-secondary);
        min-height: 100vh;
      }

      .border-bottom {
        border-color: var(--accent-color) !important;
      }

      .card {
        border: none;
        box-shadow: var(--shadow-sm);
      }

      .card-header {
        background-color: var(--bg-light);
        border-bottom: 1px solid var(--accent-color);
        color: var(--text-primary);
      }

      .btn-outline-secondary {
        border-color: var(--secondary-color);
        color: var(--secondary-color);
      }

      .btn-outline-secondary:hover {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
      }

      .btn-outline-warning {
        border-color: var(--warning-color);
        color: var(--warning-color);
      }

      .btn-outline-warning:hover {
        background-color: var(--warning-color);
        border-color: var(--warning-color);
      }

      .btn-outline-info {
        border-color: var(--accent-color);
        color: var(--accent-color);
      }

      .btn-outline-info:hover {
        background-color: var(--accent-color);
        border-color: var(--accent-color);
      }

      .alert-success {
        background-color: rgba(39, 174, 96, 0.1);
        border-color: var(--success-color);
        color: var(--success-color);
      }

      .alert-info {
        background-color: rgba(52, 152, 219, 0.1);
        border-color: var(--accent-color);
        color: var(--accent-color);
      }

      .alert-warning {
        background-color: rgba(243, 156, 18, 0.1);
        border-color: var(--warning-color);
        color: var(--warning-color);
      }

      .alert-danger {
        background-color: rgba(231, 76, 60, 0.1);
        border-color: #e74c3c;
        color: #e74c3c;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block admin-sidebar collapse">
          <div class="position-sticky pt-3">
            <div class="text-center mb-4">
              <img
                src="../images/logo.png"
                alt="Logo"
                class="img-fluid mb-2"
                style="max-width: 80px"
                onerror="this.style.display='none'"
              />
              <h5 class="text-white">ห้วยตึงเฒ่า Admin</h5>
              <small class="text-white-50">ระบบจัดการเนื้อหา</small>
            </div>

            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="json-editor.html">
                  <i class="fas fa-code me-2"></i>
                  แก้ไข JSON
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="../index.html" target="_blank">
                  <i class="fas fa-external-link-alt me-2"></i>
                  ดูเว็บไซต์
                </a>
              </li>
              <li class="nav-item mt-auto">
                <hr class="text-white-50" />
                <a class="nav-link text-danger" href="#" onclick="logout()">
                  <i class="fas fa-sign-out-alt me-2"></i>
                  ออกจากระบบ
                </a>
              </li>
            </ul>
          </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 admin-content">
          <div
            class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
          >
            <h1 class="h2"><i class="fas fa-code me-2"></i>แก้ไขไฟล์ JSON</h1>
            <div class="btn-toolbar mb-2 mb-md-0">
              <div class="btn-group me-2">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-secondary"
                  onclick="refreshJsonList()"
                >
                  <i class="fas fa-sync-alt me-1"></i>รีเฟรช
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-outline-info"
                  onclick="testJsonLoad()"
                >
                  <i class="fas fa-bug me-1"></i>ทดสอบ
                </button>
              </div>
            </div>
          </div>

          <!-- Alert area -->
          <div id="alertArea"></div>

          <!-- JSON File Selection -->
          <div class="row mb-4" id="jsonFileList">
            <div class="col-12">
              <h4 class="mb-3">เลือกไฟล์ JSON ที่ต้องการแก้ไข</h4>
            </div>

            <!-- Homepage JSON Files -->
            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('homepage-carousel')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-images fa-3x text-primary mb-3"></i>
                  <h5 class="card-title">Carousel หน้าหลัก</h5>
                  <p class="card-text text-muted">จัดการสไลด์รูปภาพหน้าหลัก</p>
                  <small class="text-info">homepage-carousel.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('homepage-news')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-newspaper fa-3x text-success mb-3"></i>
                  <h5 class="card-title">ข่าวสารหน้าหลัก</h5>
                  <p class="card-text text-muted">จัดการประกาศและข่าวสาร</p>
                  <small class="text-info">homepage-news.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('homepage-featured')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-star fa-3x text-warning mb-3"></i>
                  <h5 class="card-title">เนื้อหาเด่นหน้าหลัก</h5>
                  <p class="card-text text-muted">จัดการเนื้อหาที่น่าสนใจ</p>
                  <small class="text-info">homepage-featured.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('homepage-gallery')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-photo-video fa-3x text-info mb-3"></i>
                  <h5 class="card-title">แกลเลอรี่หน้าหลัก</h5>
                  <p class="card-text text-muted">จัดการรูปภาพในแกลเลอรี่</p>
                  <small class="text-info">homepage-gallery.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('homepage-services')"
              >
                <div class="card-body text-center">
                  <i
                    class="fas fa-concierge-bell fa-3x text-secondary mb-3"
                  ></i>
                  <h5 class="card-title">บริการหน้าหลัก</h5>
                  <p class="card-text text-muted">จัดการข้อมูลบริการ</p>
                  <small class="text-info">homepage-services.json</small>
                </div>
              </div>
            </div>

            <!-- Page JSON Files -->
            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('page-services')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-tools fa-3x text-primary mb-3"></i>
                  <h5 class="card-title">หน้าบริการ</h5>
                  <p class="card-text text-muted">จัดการเนื้อหาหน้าบริการ</p>
                  <small class="text-info">page-services.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('page-history')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-history fa-3x text-success mb-3"></i>
                  <h5 class="card-title">หน้าประวัติ</h5>
                  <p class="card-text text-muted">จัดการเนื้อหาประวัติ</p>
                  <small class="text-info">page-history.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('contact-content')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-address-book fa-3x text-warning mb-3"></i>
                  <h5 class="card-title">หน้าติดต่อ</h5>
                  <p class="card-text text-muted">จัดการข้อมูลติดต่อ</p>
                  <small class="text-info">contact-content.json</small>
                </div>
              </div>
            </div>

            <!-- Other JSON Files -->
            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('navigation')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-bars fa-3x text-info mb-3"></i>
                  <h5 class="card-title">เมนูนำทาง</h5>
                  <p class="card-text text-muted">จัดการเมนูและลิงก์</p>
                  <small class="text-info">navigation.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('footer')"
              >
                <div class="card-body text-center">
                  <i
                    class="fas fa-window-minimize fa-3x text-secondary mb-3"
                  ></i>
                  <h5 class="card-title">Footer</h5>
                  <p class="card-text text-muted">จัดการข้อมูล Footer</p>
                  <small class="text-info">footer.json</small>
                </div>
              </div>
            </div>

            <div class="col-lg-4 col-md-6 mb-3">
              <div
                class="card json-file-card h-100"
                onclick="loadJsonFile('about-content')"
              >
                <div class="card-body text-center">
                  <i class="fas fa-info-circle fa-3x text-primary mb-3"></i>
                  <h5 class="card-title">เกี่ยวกับเรา</h5>
                  <p class="card-text text-muted">จัดการเนื้อหาเกี่ยวกับเรา</p>
                  <small class="text-info">about-content.json</small>
                </div>
              </div>
            </div>
          </div>

          <!-- JSON Editor Form (Hidden initially) -->
          <div id="jsonEditorForm" style="display: none">
            <div class="card shadow">
              <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                  <h5 class="mb-0">
                    <i class="fas fa-edit me-2"></i>แก้ไขไฟล์:
                    <span id="currentFileName"></span>
                  </h5>
                  <button
                    type="button"
                    class="btn btn-sm btn-outline-secondary"
                    onclick="backToFileList()"
                  >
                    <i class="fas fa-arrow-left me-1"></i>กลับ
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div id="dynamicForm">
                  <!-- Dynamic form will be generated here -->
                </div>

                <div class="mt-4 text-center">
                  <button
                    type="button"
                    class="btn btn-save btn-lg me-2"
                    onclick="saveJsonFile()"
                  >
                    <i class="fas fa-save me-2"></i>บันทึกการเปลี่ยนแปลง
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-warning btn-lg me-2"
                    onclick="resetToOriginal()"
                  >
                    <i class="fas fa-file-import me-2"></i>โหลดต้นฉบับ
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-secondary btn-lg me-2"
                    onclick="resetForm()"
                  >
                    <i class="fas fa-undo me-2"></i>รีเซ็ต
                  </button>
                  <button
                    type="button"
                    class="btn btn-outline-info btn-lg"
                    onclick="previewJson()"
                  >
                    <i class="fas fa-eye me-2"></i>ดูตัวอย่าง JSON
                  </button>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- JSON Editor JS -->
    <script src="../js/json-editor.js"></script>

    <script>
      // Logout function
      function logout() {
        if (confirm("ต้องการออกจากระบบหรือไม่?")) {
          localStorage.removeItem("adminLoggedIn");
          localStorage.removeItem("adminLoginTime");
          window.location.href = "login.html";
        }
      }

      // Check authentication on page load
      document.addEventListener("DOMContentLoaded", function () {
        const isLoggedIn = localStorage.getItem("adminLoggedIn");
        if (isLoggedIn !== "true") {
          window.location.href = "login.html";
          return;
        }

        // Check session timeout (24 hours)
        const loginTime = localStorage.getItem("adminLoginTime");
        if (loginTime) {
          const now = new Date();
          const login = new Date(loginTime);
          const hoursDiff = (now - login) / (1000 * 60 * 60);

          if (hoursDiff > 24) {
            alert("เซสชันหมดอายุ กรุณาเข้าสู่ระบบใหม่");
            logout();
            return;
          }
        }
      });
    </script>
  </body>
</html>
""
